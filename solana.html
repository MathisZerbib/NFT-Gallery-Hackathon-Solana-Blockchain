<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <title>Art Galllery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link href="styles.css" type="text/css" rel="stylesheet" />
</head>

<body>

    <button class="connectButton"> Connect Wallet </button>
    <h2>Account: <span class="showAccount"></span></h2>

    <button class="disconnectButton"> Disconnect </button>
    <button class="sendSolButton"> Send SOLANA </button>
    <button class="walletInfoButton">Info wallet</button>
    <button class="signMessageButton">Sign message</button>
    <button class="mintNftButton">Mint NFT</button>

    <!-- <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script> -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>

    <script type="text/javascript">
        (async () => {

            const getProvider = () => {
                if ("solana" in window) {
                    const provider = window.solana;
                    if (provider.isPhantom) {
                        return provider;
                    }
                }
                window.open("https://phantom.app/", "_blank");
            };


            const isPhantomInstalled = window.solana && window.solana.isPhantom;
            // Solflare Provider replace Phantom
            // const isSolflareInstalled = window.solflare && window.solflare.isSolflare;
            const connectButton = document.querySelector('.connectButton');
            const disconnectButton = document.querySelector('.disconnectButton');
            const showAccount = document.querySelector('.showAccount');
            const sendSolButton = document.querySelector('.sendSolButton');
            const walletInfoButton = document.querySelector('.walletInfoButton');
            const signMessageButton = document.querySelector('.signMessageButton');
            const mintNftButton = document.querySelector('.mintNftButton');

            
            const connection = new solanaWeb3.Connection("https://api.devnet.solana.com");

            document.addEventListener("DOMContentLoaded", function (event) {
                if(connection && isPhantomInstalled == true) 
                {
                    window.solana.connect()
                    window.solana.on("connect", () => {
                    console.log("connected!")
                    showAccount.innerHTML = window.solana.publicKey.toString();
                    });
                }
            });


            connectButton.addEventListener('click', () => {
                window.solana.connect();
                console.log(window.solana);
                window.solana.on("connect", () => {
                    console.log("connected!")
                    showAccount.innerHTML = window.solana.publicKey.toString();
                });
            });


            disconnectButton.addEventListener('click', () => {
                window.solana.disconnect();
                window.solana.on('disconnect', () => console.log("disconnected!"))
                showAccount.innerHTML = "Disconnected"
            });

            sendSolButton.addEventListener('click', () => {
                sendSol();
            });

            walletInfoButton.addEventListener('click', () => {
                console.log(window.solana.publicKey, // wallet's publicKey
                    window.solana.connected, // true or false
                    window.solana.network) // mainnet-beta or testnet)
            });
            signMessageButton.addEventListener('click', () => {
                singMessage();

            });

            mintNftButton.addEventListener('click', () => {
                // mintNft()
                console.log("COMING SOON")
            })

            async function singMessage() {
                const message = `To avoid digital dognappers, sign below to authenticate with Nft Galllery`;
                const encodedMessage = new TextEncoder().encode(message);
                const signedMessage = await window.solana.signMessage(encodedMessage, "utf8");
            };

            // async function mintNft() {
            //     var fromWallet = solanaWeb3.Keypair.generate();
            //     var fromAirdropSignature = await connection.requestAirdrop(
            //         fromWallet.publicKey,
            //         solanaWeb3.LAMPORTS_PER_SOL,
            //     );
            //     //wait for airdrop confirmation
            //     await connection.confirmTransaction(fromAirdropSignature);
            //     let mint = await window.solana.splToken.Token.createMint(
            //         connection,
            //         fromWallet,
            //         fromWallet.publicKey,
            //         null,
            //         9,
            //         splToken.TOKEN_PROGRAM_ID,
            //     );

            //     //get the token account of the fromWallet Solana address, if it does not exist, create it
            //     let fromTokenAccount = await mint.getOrCreateAssociatedAccountInfo(
            //         fromWallet.publicKey,
            //     );

            //     // Generate a new wallet to receive newly minted token
            //     var toWallet = window.solana.Keypair.generate();

            //     //get the token account of the toWallet Solana address, if it does not exist, create it
            //     var toTokenAccount = await mint.getOrCreateAssociatedAccountInfo(
            //         toWallet.publicKey,
            //     );

            //     //minting 1 new token to the "fromTokenAccount" account we just returned/created
            //     await mint.mintTo(
            //         fromTokenAccount.address, //who it goes to
            //         fromWallet.publicKey, // minting authority
            //         [], // multisig
            //         1000000000, // how many
            //     );

            //     await mint.setAuthority(
            //         mint.publicKey,
            //         null,
            //         "MintTokens",
            //         fromWallet.publicKey,
            //         []
            //     )

            //     // Add token transfer instructions to transaction
            //     var transaction = new solanaWeb3.Transaction().add(
            //         window.solana.splToken.Token.createTransferInstruction(
            //             splToken.TOKEN_PROGRAM_ID,
            //             fromTokenAccount.address,
            //             toTokenAccount.address,
            //             fromWallet.publicKey,
            //             [],
            //             1,
            //         ),
            //     );

            //     // Sign transaction, broadcast, and confirm
            //     var signature = await solanaWeb3.sendAndConfirmTransaction(
            //         connection,
            //         transaction,
            //         [fromWallet],
            //         { commitment: 'confirmed' },
            //     );
            //     console.log('SIGNATURE', signature);
            // }

            async function sendSol() {

                var transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: window.solana.publicKey,
                        toPubkey: "2TBxdpf2CxMghgopFmJT7DQt8YomaKakKtzL212kAKb9",
                        lamports: solanaWeb3.LAMPORTS_PER_SOL //Investing 1 SOL. Remember 1 Lamport = 10^-9 SOL.
                    }),
                );

                // Setting the variables for the transaction
                transaction.feePayer = await window.solana.publicKey;
                let blockhashObj = await connection.getRecentBlockhash();
                transaction.recentBlockhash = await blockhashObj.blockhash;

                // Transaction constructor initialized successfully
                if (transaction) {
                    console.log("Txn created successfully");
                }

                // Request creator to sign the transaction (allow the transaction)
                let signed = await window.solana.signTransaction(transaction);
                // The signature is generated
                let signature = await connection.sendRawTransaction(signed.serialize());
                // Confirm whether the transaction went through or not
                await connection.confirmTransaction(signature);

                console.log("Signature: ", signature);
            };
        })();
    </script>


</body>